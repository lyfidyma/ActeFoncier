<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
       xmlns:layout="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"
      layout:decorate="~{template3}">
<head>
<meta charset="UTF-8"/>
<title>Nouveau document</title>

<style>
h4{
	color:#03B74C;
	font-family:Georgia;
}
label{
	font-size:12px;
	font-family:Arial;
	color:#889599;
}
input[type=text]:focus {
  background-color: lightcyan;
}
textarea:focus {
  background-color: lightcyan;
}
.error{
	color:red;
}



</style>

</head>
<body>
	<div layout:fragment="content">
		<div class="container">
			<div class="col-md">
				<div class="panel panel-primary">
					<div class="panel-heading">Nouveau document</div>
					
					<div class="panel-body">
						<form th:action="@{/sauvegarderDocument}" method="post" th:object="${unDocument}" enctype="multipart/form-data" onsubmit="return confirm('Voulez-vous enregistrer?')">	
						<p th:if="${messageDoublon}" th:text="${messageDoublon}" style= color:red></p>
						<div th:each="d:${unDocument}">
							  <div class="col-md-3">
							  <label>Type de document</label>
							      <select id="typeDoc" name ="typeDoc" class="form-control" th:object="${type}">
							      <option value="" hidden>Type de document</option>
							      <option th:each="t:${type}" th:text="${t.typeDoc}" th:value="${t.typeDoc}"></option>
							      
							    </select>
							     <p th:if="${messageTypeDoc}" th:text="${messageTypeDoc}" style= color:red></p>
							  </div>
							  
							  <div class="col-md-3">
							   <label>Numéro du document</label>
							    <input type="text" th:field="*{numDocument}" class="form-control" placeholder="Numéro du document" />
  						 		<p th:if="${#fields.hasErrors('numDocument')}" th:errors="*{numDocument}" th:errorclass="error"></p>
							  </div>
							  <div class="col-md-3">
						     	<label for="dateDocument" >Date du document</label>
							    <input type="date" name="dateDocument" class="form-control" />
							    
							    </div>
							    <br style="clear: both;"/>
							    
							  <div class="col-md-3">
							   <label>Objet</label>
								<textarea style="resize:none" class="form-control" th:field="*{objetDocument}" rows="4" placeholder="Objet" ></textarea>
							  </div>
						 
						   
						   <div class="col-md-6">
							    <label for="responsable" class="form-label">Responsable du document</label>
							    <input type="text" name = "responsableDocument"  th:value="*{responsableDocument}" class="form-control" placeholder="Responsable" />
							  </div>
							  <br style="clear: both;"/>
							  &ensp;
						   <h4>Bénéficiare</h4>
						   <hr/>
						   <p></p>
						   <!-- <fieldset style="border:2px groove #999; border-radius:8px; box-shadow:0 0 8px #999;padding:6px; ">
						<legend style="font-size:14px; background-color:ligthgreen"><b>Bénéficiaire</b></legend> -->
							  <div class="col-md-3">
							   <label>Type</label>
							    <select id="typeBeneficiaire" name="typeBeneficiaire"  class="form-control" onchange="showDiv('forEntreprise', this)">
							      <option value="" hidden>------------</option>
							      <option value="Entreprise">Entreprise</option>
							       <option value="Particulier">Particulier</option>						       
							    </select>
							  </div>
							  <script>
      							function showDiv(divId, element) {
      							   document.getElementById(divId).style.display = element.value == "Entreprise" ? 'block' : 'none';
    							  }
  							  </script> 
  							  
  							  <div th:each="d:${unDocument}">
  							  <div class="col-md-3" th:object="${unePersonne}">
  							  <label for="cni" class="form-label">Cni</label>
							    <input type="text" id="cni" th:field="*{cni}" class="form-control" placeholder="Numéro de la pièce d'identité"
							   th:onchange="getBeneficiaire()"/>
						 		<p th:if="${messageCni}" th:text="${messageCni}" style= color:red></p>
						 		 <p th:if="${#fields.hasErrors('cni')}" th:errors="*{cni}" th:errorclass="error"></p>
						 		 <p> </p>
						 		 <script>
						  
						  function getBeneficiaire() {
							 
								 /* window.location.href='/getBeneficiaire?cni='+$("#cni").val(); */
								 /* var eventCni = document.getElementById("cni").value;   
								  $.get('/getBeneficiaire', {'cni':eventCni}); 
								document.getElementById("nin").value=data.nin;  */
							  }
  						  </script> 
						     	<label for="nin" class="form-label">Numéro CEDEAO</label>
							    <input type="text" id="nin" name="nin" th:value="${nin}" class="form-control" placeholder="Numéro CEDEAO"/>
							    <p th:if="${messageCEDEAO}" th:text="${messageCEDEAO}" style= color:red></p>
							    <p th:if="${#fields.hasErrors('nin')}" th:errors="*{nin}" th:errorclass="error"></p>
						 	</div >
							   
							  
							   <div class="col-md-6" id="forEntreprise" style="display: none;" th:object="${uneEntreprise}" >
							   <label>Ninea</label>
							    <input type="text" th:field="*{ninea}" class="form-control"  placeholder="Ninea" aria-label="ninea"/>	    
							  <p></p>
							   <label>Nom de l'entreprise</label>
							   <input type="text"  name ="nomEntreprise" th:value="*{nomEntreprise}" class="form-control"
							   			placeholder="Nom de l'Entreprise" />
							  </div>

						   <br style="clear: both;"/>
						  		<p></p>			   
						   <div class="col-md-3" th:object="${unePersonne}" >
							    <label>Nom</label>
							    <input type="text" th:field="*{nomPersonne}" class="form-control" placeholder="Nom" />
							 <p th:if="${#fields.hasErrors('nomPersonne')}" th:errors="*{nomPersonne}" th:errorclass="error"></p>
							 </div>
							 <div class="col-md-3" th:object="${unePersonne}" >
							   <label>Prénom</label>
							    <input type="text" name ="prenom" th:value="${prenom}" class="form-control" placeholder="Prénom" />
							 <p th:if="${#fields.hasErrors('prenom')}" th:errors="*{prenom}" th:errorclass="error"></p>
							  </div>
						   
						   <div class="col-md-3" th:object="${unePersonne}">
						     	<label for="dateDelivrance" class="form-label" style="font-size:12px">Date délivrance</label>
							    <input type="date" name="dateDelivrance" th:value="${dateDelivrance}" class="form-control" />
						  </div>	
						 </div>
						<!--  </fieldset> -->
						 <br style="clear: both;"/>
						 &ensp;
						   <h4>Titre de propriété</h4>
						   <hr/>
						  <div class="col-md-3">
							    <label for="lot" class="form-label">Lot</label>
							    <input type="text" th:field="*{lot}" class="form-control" placeholder="Lot" />
							    <p th:if="${#fields.hasErrors('lot')}" th:errors="*{lot}" th:errorclass="error"></p>
							  </div>
							 
							  <div class="col-md-3">
							    <label for="titreGlobal" class="form-label">Titre global</label>
							    <input type="text" th:field ="*{titreGlobal}"  class="form-control" placeholder="Titre global" />
							     <p th:if="${#fields.hasErrors('titreGlobal')}" th:errors="*{titreGlobal}" th:errorclass="error"></p>
							  </div>
						 
						  <div class="col-md-3">
						     	<label for="superficie" class="form-label">Superficie</label>
							    <input  type="text" th:field="*{superficie}" class="form-control" placeholder="Superficie" />
							     <p th:if="${#fields.hasErrors('superficie')}" th:errors="*{superficie}" th:errorclass="error"></p>
						  </div>
						  
						  <div class="col-md-3">
						     	<label for="nicad" class="form-label">Nicad</label>
							    <input type="text" th:field="*{nicad}" class="form-control"  placeholder="nicad" />
							     <p th:if="${#fields.hasErrors('nicad')}" th:errors="*{nicad}" th:errorclass="error"></p>
						  </div>
						  <br style="clear: both;"/>
						   <p></p>
						  
						   <div class="col-md-3">
						     	<label for="comm" class="form-label">Commune</label>
							    <input type="text" id= "comm" name="comm" th:value="${comm}" class="form-control" placeholder="Commune"
							   />
							   <p th:if="${messageCommune}" th:text="${messageCommune}" style= color:red></p>
						  </div>	
  						  <script>
						  
						  function getLocalisation() {
								window.location='/getLocalisation?comm='+$("#comm").val();
							  }
  						  </script> 
						  <div class="col-md-3">
						     	<label for="communeArrond" class="form-label">Commune d'arrondissement</label>
							    <input type="text" id="communeArrond" th:value="${commArrond}" name="communeArrond"  class="form-control" placeholder="Commune d'arrondissement" readonly/>
						  </div>
						  <div class="col-md-3">
						     	<label for="departement" class="form-label">Département</label>
							    <input type="text" id="departement" th:value="${dep}"  name="departement" class="form-control" placeholder="Département" readonly/>
						  </div>
						 
						  <div class="col-md-3">
						     	<label for="region" class="form-label">Région</label>
							    <input type="text" id="region" th:value="${reg}"  name="region" class="form-control" placeholder="Région" readonly/>
						  </div>
						 
						  <br style="clear: both;"/>
						  
						   &ensp;
						   <h4>Pièce(s) jointe(s)</h4>
						   <hr/>
						  <div class="col-md-2" >
						     	<label for="numPj" class="form-label">Numéro</label>
							    <input type="text" name="numPj" class="form-control" placeholder="Numéro"/>
						  </div>	
						  
						  <div class="col-md-2">
						     	<label for="datePieceJointe" class="form-label" style="font-size:12px">Date</label>
							    <input type="date" name="datePj" class="form-control" />
						  </div>
						  <div class="col-md-4" >
						     	<label for="objetPj" class="form-label">Objet</label>
							    <input type="text" name="objetPj" class="form-control" placeholder="Objet pièce jointe"/>
						  </div>
						   
						   <div class="col-md-4" >
						   <label></label>
						 <input type="file" name="file" />
					 </div>
					 <br style="clear: both;"/>
						  <div class="col-md-3">
						
						  <p></p>
						
						  <p><a><span id="spanPj" class="glyphicon glyphicon-plus"></span></a></p> 
						  </div>
						   
						  <script>
						  var b1 = document.getElementById("spanPj");
						  b1.addEventListener("click", showPj);
						  function showPj() {
								document.getElementById("forPj").style.display= "block";
							  }
  						  </script> 
  						  
						  <br style="clear: both;"/>
						   
  						  <div id="forPj" style="display: none;">
						  <div class="col-md-2" >
						     	<label for="numPj1" class="form-label">Numéro</label>
							    <input type="text" name="numPj1" class="form-control" placeholder="Numéro"/>
						  </div>	
						  <div class="col-md-2" >
						     	<label style="font-size:12px">Date</label>
							    <input type="date" name="datePj1" class="form-control" />
						  </div>
						  <div class="col-md-4" >
						     	<label for="objetPj1" class="form-label">Objet</label>
							    <input type="text" name="objetPj1" class="form-control" placeholder="Objet pièce jointe"/>
						  </div>
						  <div class="col-md-4" >
						   <label></label>
						 <input type="file" name="file1" />
					 </div>
					  <br style="clear: both;"/>
						   <div class="col-md-3">
						  <label></label>
						  <p></p>
						
						  <p><a><span id="spanPj1" class="glyphicon glyphicon-minus"></span></a></p> 
						  </div>
						  </div>
						   <script>
						  var b2 = document.getElementById("spanPj1");
						  b2.addEventListener("click", hidePj);
						  function hidePj() {
								
								document.getElementById("forPj").style.display= "none";
							  }	
  							  </script> 
						 <br style="clear: both;"/>
					  <div class="col-md-3">
					    <button type="submit" class="btn btn-primary">Enregistrer</button>
					  </div>
	
	<!-- Fenetre modal -->				
	<div th:if="${flag} eq '1'" class="modal fade" role="dialog" id="myModal" th:each="d:${unDocument}">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Document enregistré</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" >
     
      <table>
       <tr>
			<th>Code du document : </th>
			<td th:text="${d.codeUniqueDocument}"></td>
		</tr>
     	 <tr >
			<th>Type de document :</th>
			
				<td th:text="${d.typeDocument.typeDoc}"></td>
				</th:block>
		</tr>
        <tr>
			<th>Numéro du document :</th>
			<td th:text="${d.numDocument}"></td>
		</tr>
		<tr>
			<th>Bénéficiaire : </th>
			
			<th:block th:if="${d.typeBeneficiaire} eq 'Particulier'">
				<td th:text="${d.beneficiaire.nomPersonne}"></td>
			</th:block>
				
			<th:block th:if="${d.typeBeneficiaire} eq 'Entreprise'">
				<td th:text="${d.beneficiaire.nomEntreprise}"></td>
			</th:block>
			</th:block>
		<tr>
         </table>
      
       </div>
      <div class="modal-footer">
        <a th:href="@{/ajouter}" class="btn btn-primary">Fermer </a>
        <a th:href="@{/pdfExport(id=${d.idDocument})}" class="btn btn-success">Imprimer 
 						<i class="glyphicon glyphicon-print" ></i></a>
      </div>
    </div>
  </div>
</div>
<script th:inline="javascript" th:if="${flag} eq '1'">
		$('#myModal').modal('show');
</script>

					</div>
					</form>
				</div>
			</div>
		</div>	
	 </div>
	</div> 
	 
</body>
</html>